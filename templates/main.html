<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ü©∫ Medical AI Chatbot</title>

  <link rel="stylesheet" href="static/main.css">
</head>

<body>

<nav>
  <div class="ham-menu">
    <span></span><span></span><span></span>
  </div>
  <div>ü©∫ Medical Chatbot</div>
  <div class="new-chat" onclick="newChat()">+</div>
</nav>

<div id="main">

  <!-- SIDEBAR -->
  <div id="sidenav">
    <div class="sidenav-content">
      <button id="close">‚úñ</button>
      <button id="new-chat-btn" onclick="newChat()">+ New Consultation</button>

      <div class="config">
        <hr />
        <p onclick="clearChats()">Clear conversations</p>
        <p onclick="toggleDarkMode()" style="cursor:pointer;">üåô Dark mode</p>
      </div>
    </div>
  </div>

  <!-- CHAT AREA -->
  <div id="content-body">

    <!-- CHAT MESSAGES  -->
    <div id="messages"></div>   

    <!-- INPUT -->
    <div id="chat-section">
      <input
        type="text"
        id="user-input"
        placeholder="Ask a medical question..."
        onkeypress="handleEnter(event)"
      />
      <button onclick="sendMessage()">Send</button>
    </div>

  </div>
</div>
<script>
let sessionId = null; // store session ID across messages

function sendMessage() {
    const input = document.getElementById("user-input");
    const message = input.value.trim();
    if (!message) return;

    appendMessage("user", message);
    input.value = "";

    // -----------------------------
    // Fetch call to Flask /chat
    // -----------------------------
    fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: message, session_id: sessionId })
    })
    .then(res => res.json())
    .then(data => {
        appendMessage("bot", data.reply);
        sessionId = data.session_id; // keep session ID for next message
    })
    .catch(() => appendMessage("bot", "‚ö†Ô∏è Server error"));
}

// Enter key triggers sendMessage
function handleEnter(e) {
    if (e.key === "Enter") sendMessage();
}

// Append messages to chat UI
function appendMessage(sender, text) {
    const messages = document.getElementById("messages");
    const div = document.createElement("div");
    div.className = sender === "user" ? "user-message message" : "gpt-message message";

    div.innerHTML = `
      <div class="message-div">
        <div class="message-profile-pic">
            <img src="${
              sender === "user"
                ? "/static/default-user.png"
                : "/static/bot-medical.png"
            }" height="30" width="30">
        </div>
        <div class="message-content">
          <p style="white-space: pre-line;">${text}</p>
        </div>
      </div>
    `;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}
</script>


<script>
function newChat() {
    document.getElementById("messages").innerHTML = "";
}

function clearChats() {
    document.getElementById("messages").innerHTML = "";
}

function toggleDarkMode() {
    document.body.classList.toggle("dark");
}
</script>


</body>
</html>
